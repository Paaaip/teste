<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel de Controle - Webhooks</title>
</head>
<body>
    <div>
        <label for="numDisparos">Número de Disparos</label>
        <input type="text" id="numDisparos" placeholder="Digite o número">
        <button onclick="enviarDisparos()">Enviar</button>
        <label>Disparos a serem feitos:</label>
        <label id="numDisparosOut">0</label>
    </div>

    <div>
        <label>Disparos feitos:</label>
        <label id="visorDisparos">0</label>
        <button onclick="checharDisparos()">Atualizar</button>
    </div>

    <div>
        <label>Reiniciar Planilha</label>
        <button>Reiniciar</button>
    </div>

    <div>
        <label>Travar Disparos</label>
        <button onclick="travaswitch(); checktrava()">Travar</button>
        <label id="travacheck">0</label>
    </div>

<script>

    const WEBHOOK_POST = "https://b4b-n8n.ajndqt.easypanel.host/webhook/controle-disparos-post"
    const WEBHOOK_GET = "https://b4b-n8n.ajndqt.easypanel.host/webhook/controle-disparos-get"

    async function enviarDisparos() {
        const valor = document.getElementById("numDisparos").value;
        await fetch(WEBHOOK_POST, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ numDisparos: valor})
        })
        document.getElementById("numDisparosOut").innerHTML = valor;
    }

    async function checharDisparos() {
        const resposta = await fetch(WEBHOOK_GET, { method: 'GET'});
        const data = await resposta.json().catch(async () => await resposta.text());
        document.getElementById("visorDisparos").innerHTML = JSON.stringify(data)
    }

    async function travaswitch() {
        await fetch(WEBHOOK_POST, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ toggle: "toggleBlock"})
        })
        if (document.getElementById("travacheck").innerHTML === "true") {
            document.getElementById("travacheck").innerHTML = "false";
        } else {
            document.getElementById("travacheck").innerHTML = "true";
        }
    }

    function checktrava() {
    setTimeout(async () => {
        const trava = await fetch("https://b4b-n8n.ajndqt.easypanel.host/webhook/controle-disparos-checktrava", {method: "GET"});
        const data = await trava.json().catch(async () => await trava.text());
        document.getElementById("travacheck").innerHTML = JSON.stringify(data);
    }, 1000); // 3 segundos de delay
    }

    window.onload = function(){
        checharDisparos();
        checktrava();
    }

</script>
</body>
</html>